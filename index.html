<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Financial Analyst Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Padauk', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
        }
        .glass-card {
            background: rgba(22, 27, 34, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
         .glass-card-hoverable {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .glass-card-hoverable:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .spinner {
            border-top-color: #58a6ff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tab-btn {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            color: #58a6ff;
            border-bottom-color: #58a6ff;
        }
        #file-drop-zone {
            border: 2px dashed #30363d;
            transition: all 0.3s ease;
        }
        #file-drop-zone.dragover {
            border-color: #58a6ff;
            background-color: rgba(88, 166, 255, 0.1);
        }
        .output-card h3 {
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            padding-bottom: 0.75rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #30363d;
        }
        .sentiment-bar-container {
            background-color: #374151;
            border-radius: 9999px;
            overflow: hidden;
            height: 6px;
        }
        .sentiment-bar {
            transition: width 0.5s ease-in-out;
            height: 100%;
        }
        .bullish-bar { background-color: #22c55e; }
        .bearish-bar { background-color: #ef4444; }
        .card-loader {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 75px;
        }
        .asset-checkbox {
            color: #4f46e5;
            background-color: #374151;
            border-color: #4b5563;
        }
        .skeleton-loader {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            50% { opacity: .5; }
        }
        .skeleton-bar {
            background-color: #21262d;
            border-radius: 4px;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-6 md:p-8">
    <div class="container mx-auto max-w-5xl w-full">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">AI Financial Analyst Suite</h1>
            <p class="text-lg text-gray-400">Fundamental နှင့် Technical သုံးသပ်ချက်များကို တစ်နေရာတည်းတွင် ရယူပါ။</p>
        </header>

        <div class="mb-6">
            <div class="flex border-b border-gray-700">
                <button id="fundamental-tab-btn" class="tab-btn active px-4 py-3 text-lg font-semibold">Fundamental Analysis</button>
                <button id="chart-tab-btn" class="tab-btn px-4 py-3 text-lg font-semibold">Chart Analysis</button>
            </div>
        </div>

        <main>
            <!-- ===== Fundamental Analysis Tool ===== -->
            <div id="fundamental-tool" class="space-y-6">
                <div class="glass-card rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">ကြည့်ရှုလိုသော Asset များကိုရွေးပါ</h2>
                    <div id="asset-checkbox-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-x-6 gap-y-3">
                    </div>
                </div>

                <div class="glass-card rounded-xl p-6">
                    <div class="flex justify-between items-center mb-4">
                         <h2 class="text-2xl font-bold text-white">Sentiment Dashboard</h2>
                         <div class="flex items-center space-x-4">
                            <p class="text-xs text-gray-400" id="last-updated">နောက်ဆုံးစစ်ဆေးခဲ့သည့်အချိန်: -</p>
                            <button id="refresh-btn" class="flex items-center px-3 py-1.5 border border-gray-600 text-xs font-medium rounded-md text-gray-300 bg-gray-700 hover:bg-gray-600 transition disabled:opacity-50">
                                <svg id="refresh-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise mr-2" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/></svg>
                                Refresh
                            </button>
                         </div>
                    </div>
                    <div id="realtime-grid-container" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
                </div>

                <div class="glass-card rounded-xl p-6 space-y-4">
                    <div>
                        <label for="asset-select" class="block mb-2 text-sm font-medium text-white">အသေးစိတ်သုံးသပ်လိုသော ပစ္စည်းကိုရွေးပါ</label>
                        <select id="asset-select" class="w-full p-2.5 bg-[#161b22] border border-[#30363d] rounded-lg"></select>
                    </div>
                    <button id="analyze-btn" class="w-full bg-[#238636] hover:bg-[#2ea043] text-white font-bold py-3 px-4 rounded-lg transition">အသေးစိတ် သုံးသပ်ချက်ရယူပါ</button>
                </div>
                <div id="loader" class="text-center py-10" style="display: none;">
                    <div class="spinner w-12 h-12 rounded-full border-4 border-gray-600 mx-auto"></div>
                    <p class="mt-4 text-gray-300">နောက်ဆုံးရ သတင်းအချက်အလက်များကို ရှာဖွေသုံးသပ်နေပါသည်...</p>
                </div>
                <div id="analysis-output" class="space-y-6"></div>
            </div>

            <!-- ===== Chart Analysis Tool ===== -->
            <div id="chart-tool" style="display: none;">
                <div id="file-drop-zone" class="glass-card rounded-xl p-8 text-center">
                    <label for="file-upload" class="cursor-pointer">
                        <div class="flex flex-col items-center justify-center">
                            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <p class="mt-4 text-lg text-white">Chart ပုံကို ဒီနေရာမှာဆွဲထည့်ပါ</p>
                            <p class="text-gray-400">သို့မဟုတ်</p>
                            <p class="mt-2 text-[#58a6ff] font-semibold">Browse File</p>
                        </div>
                    </label>
                    <input id="file-upload" type="file" class="hidden" accept="image/*">
                    <p id="file-name" class="text-gray-400 mt-4 text-sm"></p>
                </div>
                <div id="chart-result-container" class="mt-6 space-y-6" style="display: none;">
                    <div id="image-preview" class="glass-card rounded-xl p-4">
                        <img src="" alt="Uploaded Chart" class="rounded-lg shadow-lg w-full max-h-[500px] object-contain">
                    </div>
                    <div class="glass-card rounded-xl p-6">
                        <h2 class="text-2xl font-bold text-white mb-4">AI ၏ သုံးသပ်ချက်</h2>
                        <div id="chart-loader" style="display: none;">
                           <div class="space-y-4 skeleton-loader">
                               <div class="h-4 skeleton-bar w-3/4"></div>
                               <div class="space-y-2"><div class="h-3 skeleton-bar w-full"></div><div class="h-3 skeleton-bar w-5/6"></div></div>
                               <div class="h-4 skeleton-bar w-1/2"></div>
                               <div class="space-y-2"><div class="h-3 skeleton-bar w-full"></div><div class="h-3 skeleton-bar w-full"></div><div class="h-3 skeleton-bar w-3/4"></div></div>
                           </div>
                        </div>
                        <div id="chart-output" class="text-gray-300 space-y-3 leading-relaxed"></div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="text-center text-xs text-gray-500 mt-12 p-4 bg-gray-900/50 rounded-lg">
            <p class="font-bold mb-1">သတိပြုရန်:</p>
            <p>ဤသုံးသပ်ချက်များသည် AI မှ ပညာရေးဆိုင်ရာနှင့် သတင်းအချက်အလက်ပေးရန်အတွက်သာဖြစ်ပြီး ငွေကြေးဆိုင်ရာ အကြံပေးချက်များ လုံးဝမဟုတ်ပါ။ အရောင်းအဝယ်မပြုလုပ်မီ သင့်ကိုယ်ပိုင်လေ့လာသုံးသပ်မှုများ ပြုလုပ်ပါ။</p>
        </footer>
    </div>

<script>
    const MY_API_KEY = "AIzaSyB_3JVjaawvFE_HmRXsXU9xAkowByizKDQ"; 

    // --- Asset Data ---
    const assets = [
        { name: "ရွှေ (Gold - XAU/USD)", value: "Gold (XAU/USD)" }, { name: "EUR/USD", value: "EUR/USD" },
        { name: "GBP/USD", value: "GBP/USD" }, { name: "USD/JPY", value: "USD/JPY" }, { name: "AUD/USD", value: "AUD/USD" },
        { name: "USD/CAD", value: "USD/CAD" }, { name: "USD/CHF", value: "USD/CHF" }, { name: "NZD/USD", value: "NZD/USD" },
        { name: "Bitcoin (BTC/USD)", value: "Bitcoin (BTC/USD)" }, { name: "ရေနံစိမ်း (Crude Oil)", value: "Crude Oil" },
        { name: "S&P 500 Index", value: "S&P 500 Index" }
    ];
    const defaultSelectedAssets = ["Gold (XAU/USD)", "EUR/USD", "GBP/USD", "Bitcoin (BTC/USD)"];

    // --- DOM Elements ---
    const fundamentalTabBtn = document.getElementById('fundamental-tab-btn');
    const chartTabBtn = document.getElementById('chart-tab-btn');
    const fundamentalTool = document.getElementById('fundamental-tool');
    const chartTool = document.getElementById('chart-tool');
    
    // Fundamental Tool Elements
    const analyzeBtn = document.getElementById('analyze-btn');
    const loader = document.getElementById('loader');
    const analysisOutput = document.getElementById('analysis-output');
    const assetSelect = document.getElementById('asset-select');
    const gridContainer = document.getElementById('realtime-grid-container');
    const lastUpdatedEl = document.getElementById('last-updated');
    const refreshBtn = document.getElementById('refresh-btn');
    const refreshIcon = document.getElementById('refresh-icon');
    const assetCheckboxContainer = document.getElementById('asset-checkbox-container');
    
    // Chart Tool Elements
    const fileUpload = document.getElementById('file-upload');
    const fileNameDisplay = document.getElementById('file-name');
    const chartResultContainer = document.getElementById('chart-result-container');
    const imagePreview = document.querySelector('#image-preview img');
    const chartLoader = document.getElementById('chart-loader');
    const chartOutput = document.getElementById('chart-output');
    const fileDropZone = document.getElementById('file-drop-zone');

    // --- Tab Switching Logic ---
    fundamentalTabBtn.addEventListener('click', () => {
        fundamentalTool.style.display = 'block'; chartTool.style.display = 'none';
        fundamentalTabBtn.classList.add('active'); chartTabBtn.classList.remove('active');
    });
    chartTabBtn.addEventListener('click', () => {
        fundamentalTool.style.display = 'none'; chartTool.style.display = 'block';
        chartTabBtn.classList.add('active'); fundamentalTabBtn.classList.remove('active');
    });

    // --- Fundamental Analysis Logic ---
    function initializeFundamentalUI() {
        let checkboxHTML = '', selectHTML = '';
        assets.forEach(asset => {
            const isChecked = defaultSelectedAssets.includes(asset.value) ? 'checked' : '';
            checkboxHTML += `<label class="flex items-center space-x-2 text-sm text-gray-200 cursor-pointer hover:text-white"><input type="checkbox" value="${asset.value}" class="asset-checkbox w-4 h-4 rounded focus:ring-indigo-500" ${isChecked}><span>${asset.name}</span></label>`;
            selectHTML += `<option value="${asset.value}">${asset.name}</option>`;
        });
        assetCheckboxContainer.innerHTML = checkboxHTML;
        assetSelect.innerHTML = selectHTML;
        document.querySelectorAll('.asset-checkbox').forEach(cb => cb.addEventListener('change', () => { renderDashboardGrid(); updateAllCards(); }));
    }

    function getSelectedAssets() {
        const selected = [];
        document.querySelectorAll('.asset-checkbox:checked').forEach(checkbox => {
            const assetObject = assets.find(a => a.value === checkbox.value);
            if (assetObject) selected.push(assetObject);
        });
        return selected;
    }

    function renderDashboardGrid() {
        const selectedAssets = getSelectedAssets();
        if (selectedAssets.length === 0) {
            gridContainer.innerHTML = `<p class="text-gray-400 col-span-full text-center py-4">ကျေးဇူးပြု၍ အပေါ်မှ asset များကို အမှတ်ခြစ်ရွေးချယ်ပေးပါ။</p>`; return;
        }
        gridContainer.innerHTML = selectedAssets.map(asset => {
            const cardId = `card-${asset.value.replace(/[^a-zA-Z0-9]/g, '-')}`;
            return `<div id="${cardId}" class="glass-card glass-card-hoverable rounded-lg p-3 flex flex-col justify-between"><div class="flex justify-between items-start"><h3 class="font-bold text-white text-sm truncate pr-2">${asset.name}</h3><div class="sentiment-indicator w-2.5 h-2.5 rounded-full bg-gray-600 flex-shrink-0 mt-1"></div></div><div class="card-loader"><div class="spinner w-5 h-5 rounded-full border-2 border-gray-600"></div></div><div class="card-content" style="display: none;"><p class="sentiment-text text-center text-base font-bold">...</p><div class="sentiment-bar-container my-2"><div class="sentiment-bar rounded-full"></div></div><p class="percentage-text text-center text-xs text-gray-400">--% / --%</p></div></div>`;
        }).join('');
    }
    
    async function fetchSentimentForAsset(asset) { /* ... (Logic remains the same) ... */ }
    function updateCardUI(cardElement, data, quote) { /* ... (Logic remains the same) ... */ }
    async function updateAllCards() { /* ... (Logic remains the same) ... */ }
    async function getAnalysis() { /* ... (Logic remains the same) ... */ }
    function displayResults(text) { /* ... (Logic remains the same) ... */ }
    
    // --- Chart Analysis Logic ---
    fileUpload.addEventListener('change', (e) => handleFile(e.target.files[0]));
    fileDropZone.addEventListener('dragover', (e) => { e.preventDefault(); fileDropZone.classList.add('dragover'); });
    fileDropZone.addEventListener('dragleave', () => fileDropZone.classList.remove('dragover'));
    fileDropZone.addEventListener('drop', (e) => { e.preventDefault(); fileDropZone.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });

    function handleFile(file) {
        if (!file || !file.type.startsWith('image/')) return;
        fileNameDisplay.textContent = `Selected: ${file.name}`;
        chartResultContainer.style.display = 'block';
        chartOutput.innerHTML = '';
        chartOutput.classList.remove('fade-in');
        const reader = new FileReader();
        reader.onloadend = () => { imagePreview.src = reader.result; analyzeChart(file); };
        reader.readAsDataURL(file);
    }

    async function analyzeChart(file) {
        chartLoader.style.display = 'block';
        try {
            const base64Image = await fileToBase64(file);
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${MY_API_KEY}`;
            const prompt = "You are a professional technical analyst. Analyze the provided financial chart image. Identify key patterns, support and resistance levels, indicators, and suggest potential future price movements. Provide the analysis in Burmese language.";

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: file.type, data: base64Image } }
                    ]
                }]
            };

            const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { throw new Error('API request failed'); }

            const result = await response.json();
            const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (textResponse) {
                let formattedText = textResponse.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>').replace(/\* (.*?)(<br>|$)/g, '<li class="ml-4 list-disc">$1</li>');
                chartOutput.innerHTML = `<ul class="space-y-2">${formattedText}</ul>`;
                chartOutput.classList.add('fade-in');
            } else {
                throw new Error("AI မှ သုံးသပ်ချက်မရရှိပါ။");
            }
        } catch (error) {
            chartOutput.innerHTML = `<p class="text-red-400">Error: ${error.message}</p>`;
        } finally {
            chartLoader.style.display = 'none';
        }
    }

    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });
    }

    // --- Initialization and Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeFundamentalUI();
        renderDashboardGrid();
        updateAllCards();
    });
    refreshBtn.addEventListener('click', updateAllCards);
    analyzeBtn.addEventListener('click', getAnalysis);

    // --- Helper Functions from previous versions (to keep logic complete) ---
    function parseAsset(assetString) {
        if (assetString.includes('/')) {
            let pair = assetString.match(/\((.*?)\)/);
            if (pair) {
                const [base, quote] = pair[1].split('/');
                return { base, quote, pair: assetString };
            }
            const [base, quote] = assetString.split('/');
            return { base, quote, pair: assetString };
        }
        return { base: assetString, quote: 'Market', pair: assetString };
    }
    
    async function fetchSentimentForAsset(asset) {
        const { base, quote, pair } = parseAsset(asset.value);
        const cardId = `card-${asset.value.replace(/[^a-zA-Z0-9]/g, '-')}`;
        const cardElement = document.getElementById(cardId);
        if (!cardElement) return;

        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${MY_API_KEY}`;
        const prompt = `Analyze the current fundamental strength of ${base} versus ${quote} based on the very latest news and economic data. Provide a percentage strength for the base asset (${base}) and a percentage strength for the quote asset (${quote}). The two percentages must add up to 100. Based on these percentages, determine the overall market sentiment for the ${pair} as "Bullish", "Bearish", or "Neutral". Your entire response MUST be a single, valid JSON object following this exact format. Do not include any text, explanations, or markdown formatting outside of the JSON object. {"base_strength": <number>,"quote_strength": <number>,"sentiment": "<string>"}`;
        
        try {
            const payload = { contents: [{ parts: [{ text: prompt }] }], tools: [{ "google_search": {} }] };
            const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { throw new Error('API Request Failed'); }
            
            const result = await response.json();
            const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (textResponse) {
                const jsonMatch = textResponse.match(/{[\s\S]*}/);
                if (!jsonMatch) { throw new Error("No JSON found"); }
                const data = JSON.parse(jsonMatch[0]);
                updateCardUI(cardElement, data, quote);
            } else { throw new Error("No content from AI"); }
        } catch (error) {
            console.error(`Error for ${asset.name}:`, error);
            const contentEl = cardElement.querySelector('.card-content');
            const loaderEl = cardElement.querySelector('.card-loader');
            loaderEl.style.display = 'none';
            contentEl.style.display = 'block';
            contentEl.querySelector('.sentiment-text').innerHTML = `<span class="text-red-500 text-xs">Error</span>`;
        }
    }

    function updateCardUI(cardElement, data, quote) {
        const contentEl = cardElement.querySelector('.card-content');
        const loaderEl = cardElement.querySelector('.card-loader');
        loaderEl.style.display = 'none';
        contentEl.style.display = 'block';

        const barEl = contentEl.querySelector('.sentiment-bar');
        const sentimentEl = contentEl.querySelector('.sentiment-text');
        const indicatorEl = cardElement.querySelector('.sentiment-indicator');
        const percentageEl = contentEl.querySelector('.percentage-text');
        
        barEl.style.width = `${data.base_strength}%`;
        barEl.className = data.base_strength >= 50 ? 'sentiment-bar rounded-full bullish-bar' : 'sentiment-bar rounded-full bearish-bar';

        let sentimentColorClass = 'text-yellow-400';
        let indicatorColorClass = 'bg-yellow-400';

        if (data.sentiment === 'Bullish') {
            sentimentColorClass = 'text-green-400'; indicatorColorClass = 'bg-green-500';
        } else if (data.sentiment === 'Bearish') {
            sentimentColorClass = 'text-red-400'; indicatorColorClass = 'bg-red-500';
        }
        
        sentimentEl.innerHTML = `<span class="${sentimentColorClass}">${data.sentiment}</span>`;
        indicatorEl.className = `sentiment-indicator w-2.5 h-2.5 rounded-full ${indicatorColorClass} flex-shrink-0 mt-1`;
        percentageEl.textContent = (quote === 'Market') ? `${data.base_strength}%` : `${data.base_strength}% / ${data.quote_strength}%`;
    }

    async function updateAllCards() {
        const selectedAssets = getSelectedAssets();
        if (selectedAssets.length === 0) return;

        console.log("Updating selected sentiment cards...");
        const now = new Date();
        lastUpdatedEl.textContent = `နောက်ဆုံးစစ်ဆေးခဲ့သည့်အချိန်: ${now.toLocaleTimeString()}`;
        
        refreshBtn.disabled = true;
        refreshIcon.classList.add('spinner');

        for (const asset of selectedAssets) {
            await fetchSentimentForAsset(asset);
        }
        
        refreshBtn.disabled = false;
        refreshIcon.classList.remove('spinner');
        console.log("Selected cards updated.");
    }

    async function getAnalysis() {
        const userApiKey = MY_API_KEY;
        const selectedAsset = assetSelect.value;
        loader.style.display = 'block';
        analysisOutput.innerHTML = '';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${userApiKey}`;
        const prompt = `Professional Financial Analyst တစ်ယောက်အနေဖြင့် အောက်ပါအချက်များကို တိကျစွာသုံးသပ်ပေးပါ။ အဖြေအားလုံးကို မြန်မာဘာသာဖြင့်သာ ပြန်လည်ဖြေကြားပါ။ အရေးကြီးသော အဖြစ်အပျက်တိုင်းတွင် နေ့စွဲ (Date) ကို ထည့်သွင်းဖော်ပြပါ။ Asset: ${selectedAsset} 1.  **သတင်းအကျဉ်းချုပ် (News Summary):** Google Search ကိုသုံး၍ ${selectedAsset} နှင့်ပတ်သက်သော နောက်ဆုံး 24-48 နာရီအတွင်း အရေးအကြီးဆုံး သတင်းတစ်ပုဒ်ကိုရှာပါ။ **ထိုသတင်းထွက်ခဲ့သည့် နေ့စွဲကို ဖော်ပြပြီး** အဓိကအချက် ၃ ချက်ဖြင့် အကျဉ်းချုပ်ပေးပါ။ ဥပမာ- "(စက်တင်ဘာ ၃၀) - Fed ဥက္ကဌ၏ မိန့်ခွန်းအရ..." 2.  **အရေးကြီးသော စီးပွားရေးသတင်းများ (Economic Calendar):** Google Search ကိုသုံး၍ ${selectedAsset} အပေါ် သက်ရောက်မှုအရှိဆုံးဖြစ်မည့် လာမည့် 48-72 နာရီအတွင်းက Economic Calendar မှ အရေးကြီးဆုံး Event ၁ ခု သို့မဟုတ် ၂ ခုကို ဖော်ပြပါ။ Event တစ်ခုချင်းစီ၏ **ကျင်းပမည့် နေ့စွဲနှင့် အချိန် (သိနိုင်လျှင်)** ကို ထည့်သွင်းဖော်ပြပါ။ ထို့နောက် ဖြစ်နိုင်ခြေရှိသော သက်ရောက်မှု (ဥပမာ- Bullish/Bearish for the asset) ကိုပါ ရှင်းပြပါ။ 3.  **ဈေးကွက်၏ ခံစားချက် (Market Sentiment):** Google Search မှရသော နောက်ဆုံးရသတင်းများနှင့် **မကြာသေးမီက ဖြစ်ပျက်ခဲ့သော အဖြစ်အပျက်များ (ဥပမာ- မနေ့က NFP data အရ...)** ကို အခြေခံ၍ ${selectedAsset} အတွက် လက်ရှိ Market Sentiment ကို (Bullish, Bearish, Neutral) စသဖြင့် သတ်မှတ်ပေးပါ။ သင်၏ သုံးသပ်ချက်အတွက် အကြောင်းผลကို နေ့စွဲများနှင့် ချိတ်ဆက်ပြီး အတိုချုပ်ရှင်းပြပါ။ သင်၏အဖြေကို အောက်ပါပုံစံအတိုင်း ခေါင်းစဉ်များဖြင့် ရှင်းလင်းစွာဖွဲ့စည်းပေးပါ: ### သတင်းအကျဉ်းချုပ် - **[နေ့စွဲ]:** [အချက် ၁] - [အချက် ၂] - [အချက် ၃] ### အရေးကြီးသော စီးပွားရေးသတင်းများ **Event Name:** [Event ရဲ့ နာမည်] **Date & Time:** [နေ့စွဲနှင့် အချိန်] **Potential Impact:** [သက်ရောက်မှု ရှင်းလင်းချက်] ### ဈေးကွက်၏ ခံစားချက် **Sentiment:** [ဥပမာ- Bullish] **Reasoning:** [အကြောင်းผล ရှင်းလင်းချက် (နေ့စွဲများဖြင့်)]`;
        try {
            const payload = { contents: [{ parts: [{ text: prompt }] }], tools: [{ "google_search": {} }] };
            const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error ? errorData.error.message : 'API request failed'); }
            const result = await response.json();
            const candidate = result.candidates?.[0];
            if (candidate && candidate.content?.parts?.[0]?.text) { displayResults(candidate.content.parts[0].text); } 
            else { throw new Error("AI မှ အချက်အလက် ပြန်လည်ရရှိခြင်းမရှိပါ (No content in response)."); }
        } catch (error) {
            console.error("Error:", error);
            analysisOutput.innerHTML = `<div class="glass-card rounded-xl p-6 text-red-400">သုံးသပ်ချက်ရယူရာတွင် အမှားအယွင်းเกิดขึ้นပါသည်။<br>${error.message}</div>`;
        } finally {
            loader.style.display = 'none';
        }
    }
    function displayResults(text) {
        const summaryMatch = text.match(/### သတင်းအကျဉ်းချုပ်([\s\S]*?)###/);
        const calendarMatch = text.match(/### အရေးကြီးသော စီးပွားရေးသတင်းများ([\s\S]*?)###/);
        const sentimentMatch = text.match(/### ဈေးကွက်၏ ခံစားချက်([\s\S]*)/);
        let html = '';
        if (summaryMatch) { html += `<div class="output-card glass-card rounded-xl p-6"><h3>သတင်းအကျဉ်းချုပ်</h3><ul class="space-y-2 list-disc">${formatText(summaryMatch[1])}</ul></div>`; }
        if (calendarMatch) { html += `<div class="output-card glass-card rounded-xl p-6"><h3>အရေးကြီးသော စီးပွားရေးသတင်းများ</h3><div>${formatText(calendarMatch[1])}</div></div>`; }
        if (sentimentMatch) { html += `<div class="output-card glass-card rounded-xl p-6"><h3>ဈေးကွက်၏ ခံစားချက်</h3><div>${formatText(sentimentMatch[1])}</div></div>`; }
        analysisOutput.innerHTML = html;
    }
    function formatText(text) {
        return text.trim().replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>').replace(/^- (.*?)/gm, '<li>$1</li>').replace(/\n/g, '<br>');
    }
</script>
</body>
</html>

